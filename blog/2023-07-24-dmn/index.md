---
slug: dmn-prj-elva1-1
title: Передача данных подвижного объекта
authors: dmn
tags: [team, lab240]
---

## Зарисовки к проектам нашей команды

В большом проекте по обеспечению надежной высокоскоростной (10Гбит)
связью "поезд-земля", наша команда отвечает за передачу данных.

:::tip Пресса и материалы по теме

[Статья](https://habr.com/ru/articles/739496/) на Хабре про технологию "поезд-земля" и сравнение ее с WiFi и LTE.

[Ролик](https://www.youtube.com/watch?v=t48YXALtb-M) на Youtube

:::

Мы разрабатываем систему передачи данных через
радиорелейную связь подвижного объекта (поезд) на
высоких скоростях (до 300км\ч).

Суть проекта в том, что на поезде стоит радио-релейное
оборудование, которое "смотрит" вперед и назад. В каждый момент
времени мы "видим" и "теряем" базовые станции впереди поезда и сзади поезда.

Упрощенная схема выглядит так

![Alt text](img/toto1.png)

:::tip Пояснения к картинке

На самом деле на поезде 4 релейки с разной поляризацией (две смотрят вперед и две назад). Внутри "поезда" наша славный роутер,
который переключает маршруты. CGW-база - "наземный" сервер в диспетчерской, который собственно и является шлюзом в Интернет, а также потребителем трафика с камер поезда. 

Сейчас помимо беркутов мы активно используем трафик-генератор T-REX с различными профилями.

:::

Вот настоящая схема с генератором трафика T-REX.
![Alt text](img/toto2.png)

Наша задача - обеспечить непрерывный и полно-дуплексный поток
данных 10Гбит, переключая маршрутизацию от базовой станции "впереди"
к базовой станции "сзади" и обратно.

То есть, говоря сетевым языком нам надо переключать "дефоулт роут" потока 10Гбит примерно раз в 7 секунд максимально быстро (с минимальными потерями).

Беда стандартных протоколов в том, что переключения "дефаулт роутинга" очень медленное (даже на мощных сетевых маршрутизаторах), а если мы начинаем пользоваться IP-стеком Linux,
то получаем снижение скорости при интенсивном роутинге 10Гбит и (что важнее) также переключение в районе 50мс, что для нас медленно. Для любой стационарной сети это хорошее время переключения (мы используем протокол для MESH сетей BABEL), но мы то знаем что при использовании DPDK это время можно кардинально уменьшить. 

В этом проекте мы применяем технологию DPDK и мощную платформу NXP LX2160. Мы разработали
свой протокол, которые оптимизирован исключительно на эту задачу (ловить новые маршруты) При этом
мы получаем скорость переключения роутинга в районе 1-2мс (миллисекунд). 

:::info Краткое описание Flea Path

Мы генерируем сторбирующий трафик по всем интерфейсам сети. Маршрутизатор внутри поезда проверяет 4 интерфейса и при пропадании трафика на одном из интерфейсов, переключает максимально быстро в другой. 

Учитывая скорость движения поезда мы "теряем" и "находим" трафик примерно 1 раз в 7 секунд.

:::

Для проверки и тестирования мы собрали несколько стендов, один из которых представляет их себя полное физическое воплощение радиорелейной сети с регулируемым затуханием сигнала. Программа тестирования "гасит" и "поднимает" качество сигнала в радиорелейной части, обеспечивая полную эмуляцию движения поезда через "базовые" станции. 

Радио-релейная часть стенда

![Alt text](img/stand1.png)

Кроме того, для проверки влияния потерь пактов была собрана сеть из видеокамер, а также генератор трафика T-REX с профилем "смешанный трафик". Таким образом, мы эмулируем пользователей в интернете в поезде (микс из youtube, веб, видео-общения, скачиваний файлов). Также мы провели испытания, пересаживая весь наш отдел на "поезд". 

Надо с гордостью заявить, что результатами мы довольны. Мы не имеем потерь и снижения скорости. При генерации T-Rex 10гбит смешанного трафика в поезде, наш DPDK-роутер "протаскивает" через себя весь трафик. 

![Alt text](img/trex-1.png)

При натуральных испытаниях в офисе мы генерировали примерно 3Гбит трафика в пике и вообще не ощущали дискомфорта в работе.

...статья пилится...
