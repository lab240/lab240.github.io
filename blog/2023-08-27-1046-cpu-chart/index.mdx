---
slug: ls1046a-cpu-chart
title: Статистика по процессору LS1046a
authors: IgorKha
tags: [1046, NXP, CPU, chart, bash, monitoring]
---

import Image from '@theme/IdealImage';
import main from './img/header.png';

<Image img={main} />

Всем привет! В этот раз я немного расскажу про то, как мы организовали процесс сбора данных о частоте и температуре процессора без использования дополнительного программного обеспечения на базе сборки Yocto. Мы расскажем о том, как собрали данные при помощи ~~своего велосипеда~~ bash-скрипта, чтобы дополнительно не нагружать систему и как визуализировали их с использованием нашего небольшого веб-сервиса.

<!--truncate-->

## Необходимые инструменты

- Устройство с процессором NXP LS1046a
- Yocto на целевом устройстве или любой другой Linux дистрибутив
- Доступ к терминалу на устройстве.

## Решение задачи

### Описание скрипта сбора данных

Для сбора данных о частоте и температуре процессора мы используем bash-скрипт. Этот скрипт собирает данные, записывает их в формат JSON и сохраняет в файл `cpu_data.json`. Давайте рассмотрим ключевые моменты скрипта:

- Мы передаем скрипту серийный номер/имя тестируемого устройства, длительность сбора данных и (опционально) примечание.

    ```bash
    ./cpu.sh SN001 120 "Дополнительная заметка"
    ```

- Скрипт определяет функции для получения текущего времени, метки времени, частоты процессора и температуры.
  - Для LS1046a данные о частоте мы получаем из `/sys/devices/system/cpu/cpufreq/policy0/cpuinfo_cur_freq`
  - Данны о температуре мы берем из `/sys/class/hwmon/hwmon3/temp1_input`

- Данные собираются в цикле, каждую секунду, и записываются в формате JSON.

### Разбор скрипта и его функций

- Проверка аргументов командной строки.
- Определение функций для получения времени, метки времени, частоты и температуры.
- Создание и форматирование JSON-файла.
- Основной цикл сбора данных и записи их в JSON.

**Пример формируемого json файла нашим скриптом:**

```json title="cpu_data.json"
{ "SN": "SN0001",
  "note": "This is a note",
  "cpu":[
  {"timestamp":1692713925, "frequency":3219.181, "temperature":61.0},
  {"timestamp":1692713926, "frequency":2740.720, "temperature":59.0},
  {"timestamp":1692713927, "frequency":1705.188, "temperature":61.0},
  {"timestamp":1692713928, "frequency":3010.267, "temperature":68.0},
  {"timestamp":1692713929, "frequency":1500.000, "temperature":59.0},
  {"timestamp":1692713930, "frequency":1500.000, "temperature":58.0},
  {"timestamp":1692713931, "frequency":3860.388, "temperature":58.0},
  {"timestamp":1692713932, "frequency":457.516, "temperature":59.0},
  {"timestamp":1692713933, "frequency":1500.000, "temperature":59.0},
  {"timestamp":1692713934, "frequency":1500.000, "temperature":57.0}
]}
```

## Визуализация данных

Для визуализации данных мы используем веб-компонент на React, который можно найти по ссылке [cpuChart](/cpuChart). Этот сервис позволяет загружать и визуализировать данные из JSON-файла.

<Image img={require('./img/chart.jpg')} />

## Заключение

В данной статье мы рассмотрели, как решить задачу сбора данных о частоте и температуре процессора без установки дополнительного программного обеспечения. Мы использовали bash-скрипт для сбора данных и веб-сервис для их визуализации, который к слову, тоже написан нами. Этот подход позволил нам решить нашу задачу по анализу и мониторингу процессора LS1046a во время проводимых нагрузочных тестирования. Надеюсь эта информация будет кому-то полезна.

## Полезные ссылки

- [Скачать](https://gist.github.com/IgorKha/4120abd76796217ad5836b1dc1517aa9) данный скрип актуальной версии можно всегда на **Github Gist**
- [cpuChart](/cpuChart) для отображения данных из json файла `cpu_data.json`
