<!doctype html>
<html lang="ru-RU" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Летопись платы nxp ls1046 (от мертвого к живому) | Lab240</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://lab240.github.io/blog/hard-1046-log-blog"><meta data-rh="true" name="docusaurus_locale" content="ru"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="ru"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Летопись платы nxp ls1046 (от мертвого к живому) | Lab240"><meta data-rh="true" name="description" content="Мы вышли на финишную прямую в подъеме платы на nxp ls1046 и как руководитель группы разработки, как говорится, имею что сказать. Это будет не по технике (отчасти), а о процессе и жизни разработчика. Вся эта история заняла 3 недели у команды из 5 человек  это был очень непростой интенсивный процесс. Важно его описать и сделать выводы, что я и делаю."><meta data-rh="true" property="og:description" content="Мы вышли на финишную прямую в подъеме платы на nxp ls1046 и как руководитель группы разработки, как говорится, имею что сказать. Это будет не по технике (отчасти), а о процессе и жизни разработчика. Вся эта история заняла 3 недели у команды из 5 человек  это был очень непростой интенсивный процесс. Важно его описать и сделать выводы, что я и делаю."><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2023-08-26T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/dmnovikov"><meta data-rh="true" property="article:tag" content="team,lab240"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://lab240.github.io/blog/hard-1046-log-blog"><link data-rh="true" rel="alternate" href="https://lab240.github.io/blog/hard-1046-log-blog" hreflang="ru-RU"><link data-rh="true" rel="alternate" href="https://lab240.github.io/en/blog/hard-1046-log-blog" hreflang="en-US"><link data-rh="true" rel="alternate" href="https://lab240.github.io/blog/hard-1046-log-blog" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Lab240 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Lab240 Atom Feed">






<link rel="preconnect" href="https://mc.yandex.ru">
<script>!function(e,t,a,c,n,r,i){e[n]=e[n]||function(){(e[n].a=e[n].a||[]).push(arguments)},e[n].l=1*new Date,r=t.createElement(a),i=t.getElementsByTagName(a)[0],r.async=1,r.src="https://mc.yandex.ru/metrika/tag.js",i.parentNode.insertBefore(r,i)}(window,document,"script",0,"ym"),ym(95068321,"init",{defer:!0,clickmap:!0,trackLinks:!0,accurateTrackBounce:!0,webvisor:!0,ecommerce:!1,trackHash:!1})</script>
<noscript>
                            <div><img src="https://mc.yandex.ru/watch/95068321" style="position:absolute; left:-9999px;" alt=""></div>
                        </noscript><link rel="stylesheet" href="/assets/css/styles.987b3986.css">
<link rel="preload" href="/assets/js/runtime~main.e46d4798.js" as="script">
<link rel="preload" href="/assets/js/main.23a0e9f7.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(e){}return e}()||function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div role="region" aria-label="Перейти к основному содержимому"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Перейти к основному содержимому</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Переключить навигационную панель" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="Lab240 Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo_dark.png" alt="Lab240 Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div></a><a class="navbar__item navbar__link" href="/docs/intro">Портфолио</a><div class="navbar__item dropdown dropdown--hoverable"><a aria-current="page" class="navbar__link active" aria-haspopup="true" aria-expanded="false" role="button" href="/blog">lab240-блог</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/blog">Лента новостей</a></li><li><a class="dropdown__link" href="/blog/archive">Все новости</a></li><li><a class="dropdown__link" href="/blog/tags">Новости по тегам</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Tools</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/1046hextobin">1046 rcw hex to bin</a></li><li><a class="dropdown__link" href="/cpuChart">CPU chart</a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>Русский</a><ul class="dropdown__menu"><li><a href="/blog/hard-1046-log-blog" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="ru-RU">Русский</a></li><li><a href="/en/blog/hard-1046-log-blog" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en-US">English</a></li></ul></div><a href="https://github.com/lab240" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Переключение между темным и светлым режимом (сейчас используется Светлый режим)" aria-label="Переключение между темным и светлым режимом (сейчас используется Светлый режим)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Навигация по последним постам в блоге"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/modbus-stand-2">Стенд ModBus 2</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/wifi6">Замеры скоростей WiFi6</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/front-control-live-view">Сборщик-универсал. Первый взгляд живьем.</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/front-control-first-view">Сборщик-универсал. Концепт и конструктив.</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/napi-p-first-vew">Napi P. Первый взгляд.</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="title_f1Hy" itemprop="headline">Летопись платы nxp ls1046 (от мертвого к живому)</h1><div class="container_mt6G margin-vert--md"><time datetime="2023-08-26T00:00:00.000Z" itemprop="datePublished">26 августа 2023 г.</time> · <!-- -->9 мин. чтения</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/dmnovikov" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/17533288?v=4" alt="dmn"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/dmnovikov" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">dmn</span></a></div><small class="avatar__subtitle" itemprop="description">lab240 maintainer</small></div></div></div></div></header><div id="__blog-post-container" class="markdown" itemprop="articleBody"><p>Мы вышли на финишную прямую в подъеме платы на nxp ls1046 и как руководитель группы разработки, как говорится, имею что сказать. Это будет не по технике (отчасти), а о процессе и жизни разработчика. Вся эта история заняла 3 недели у команды из 5 человек  это был очень непростой интенсивный процесс. Важно его описать и сделать выводы, что я и делаю.</p><p>!<img loading="lazy" alt="Alt text" src="/assets/images/plate-with-monitor-49bef1526609f5b8cadb75e182e52cb6.jpg" width="1280" height="720" class="img_ev3q"></p><p>Мы делаем проект, в котором схемотехники делают плату на ls1046 с двумя модемами на 60ГГц (802.11ad) и первоначально я видел задачу нашей группы как чисто программную - выстроить устройства на этих платах в MESH-сеть, запустить процессы раздачи авторизаций, балансировку трафика, раздачи сервисов и прочие высокоуровневые плюшки SDN-а... как же далек от реальности я был...</p><p>Началось все с того, что принося сырую плату, нас сразу же включили в работу, так как по мнению схемотехников если побежали циферки в консоли, то дальше программисты должны настроить и залить софт и все будет отлично. Программисты же, наоборот, резонно считают, что если есть прошивка, которая работала на плате разработчика, то эта прошивка обязана работать и на плате, которую сделали схемотехники и нечего приносить иное. И посреди этих двух полярных мнений оказались мы.</p><p>В качестве отступления, могу сказать, что наша группа и сама делает платы и занимается трассировкой и мы точно знаем что на первых выпусках любых плат есть ошибки. Притом, они могут быть по схемотехнике (не додумали), по реализации (подумали так, а оно на оно на самом деле совсем не так) и просто ошибки сборки платы (есть еще вероятность некачественных компонент, но такого я не встречал пока).  Хорошая плата, если она делается с нуля в лучшем случае получается с третьего захода, но иногда ошибки таковы что плата идет в помойку, а иногда можно найти косячки, &quot;допилить&quot; и плата становится функциональной или &quot;частично функциональной&quot; и понятно как делать следующий заказ.
<strong>Главное при таком заказе не придумать и не внести новую функциональность</strong></p><p>Итак &quot;больной&quot; поступил с зависанием на стадии BL1 и без возможности зацепиться JTAG-ом. Фирменный софт CodeWarrior просто не видел платы. Так как это уже вторая итерация платы (у первой была неправильно разведена память), то мы не могли так ошибиться по памяти, нужно было искать и запускать. Иногда, это напоминало сериал &quot;Доктор Хаус&quot;, иногда хотелось просто отправить плату в утиль, но мы добились стабильной работы и точно знаем что следующий выпуск будет стабильным (при исполнении протокола изменений).</p><p>Что делалось и что было сделано.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="шаг1-процедура-запуска-процессора">ШАГ1. Процедура запуска процессора.<a href="#шаг1-процедура-запуска-процессора" class="hash-link" aria-label="Прямая ссылка на ШАГ1. Процедура запуска процессора." title="Прямая ссылка на ШАГ1. Процедура запуска процессора.">​</a></h3><p>Первое с чего начинается запуск любой платы это старт процессора. Раз он не получает JTAG, значит процедура не соблюдена. Да, у процессора своя процедура запуска с строгой подачей питания и сигналов RESET на нужные пины с нужной задержкой. Запуском  и сбросом платы коллеги поставили управлять отдельный микроконтроллер, который явно работал неправильно. Для справки, в &quot;дев борде&quot; для этого стоит ПЛИС тоже без особенной документации, но сама процедура старта описана в документации полно.</p><p>Чтобы не сражаться с схемотехниками их МК был отпаян и припаян наш STM32, для  которого мы залили прошивку , реализующую процедуру старта.</p><p><img loading="lazy" alt="Alt text" src="/assets/images/photo_2023-08-09_22-56-01-3d08fe43c198424f1df1c3ccd92218d6.jpg" width="790" height="461" class="img_ev3q"></p><p>Также были обнаружены недостающие детальки</p><p><img loading="lazy" alt="Alt text" src="/assets/images/absetn-2-bd67583fdfdc8cf0ee0d8ff48e9d7bc2.jpg" width="1000" height="749" class="img_ev3q"></p><p>Итак, через какое-то время мы попали в CW (CodeWarrior), и смогли настроить RCW для памяти, а еще через какое-то время туже процедуру написали для оригинального МK.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="шаг2-питание-питание-и-еще-раз-питание">ШАГ2. Питание питание и еще раз питание<a href="#шаг2-питание-питание-и-еще-раз-питание" class="hash-link" aria-label="Прямая ссылка на ШАГ2. Питание питание и еще раз питание" title="Прямая ссылка на ШАГ2. Питание питание и еще раз питание">​</a></h3><p>Следующая беда которая была с уже загружающейся платой - это нестабильность работы. В прошлый раз это были ошибки в импедансах (задержках) в дорожках, но в этот раз предварительно все было трассировано в xSignals и поэтому копать пришлось в сторону правильного питания. Вообще, питание и обратная связь по питанию, это то, на что легко забить и с чем потом можно бесконечно долго мучиться. Итак, проверка питания и проверка обратно связи по питанию привела к замене пачки резисторов, установке керамических конденсаторов и добавлением везде, где можно обратной связи по питанию. </p><p>Но в результате, если плата сильно не стабильна надо было найти было что-то довольно грубое и оно было найдено, там где надо было подать 0.6В, было подано 1,2B. В результате память &quot;ожила&quot; а после подстройки RCW стала стабильной по memtest-у.</p><p>Надо сказать, что любой схемотехник автор платы вовсе не счастлив признавать свои ошибки и склонен и у него как правило два мнения &quot;ваши предложения ни на что не влияют&quot; и &quot;у меня &lt;где-то&gt; и тк работает. Поэтому буквально сначала приходилось перепаиваться на своем экземпляре &quot;чтоб воду не толочь&quot; и после этого уже отдавать протокол изменений авторам платы.</p><p><em>Отметим, чтобы не забыть - разбираться в чужой плате, даже при наличии всех схем и проекта на порядок тяжелее, чем в &quot;своей&quot;.</em></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="шаг3-несущие-частоты-тяжелый-случай">ШАГ3. Несущие частоты. Тяжелый случай.<a href="#шаг3-несущие-частоты-тяжелый-случай" class="hash-link" aria-label="Прямая ссылка на ШАГ3. Несущие частоты. Тяжелый случай." title="Прямая ссылка на ШАГ3. Несущие частоты. Тяжелый случай.">​</a></h3><p>После стабилизации питания, стабилизации процедуры запуска, стабилизации reset-ов процессора мы получили &quot;почти рабочую&quot; плату. А именно плату с 1хGB и 2xPCI (где у нас находятся модемы), но без 10Гбит. </p><p>В 1046-м два 10Гбит интерфейса, за которые изначально было страшновато по нескольким причинам:</p><ol><li>Это высокоскоростные интерфейсы под SFP+ пальцы</li><li>Интерфейсы работают в одной из плат через ретаймеры, в другой напрямую из процессора.</li><li>Интерфейсы работают через SerDes.</li><li>Такие интерфейсы используются редко, и спросить по большому счету не у кого.</li></ol><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Справка от ChatGPT</div><div class="admonitionContent_S0QG"><p>SerDes - это сокращение от &quot;Serializer/Deserializer&quot; (сериализатор/десериализатор). Это технология, которая используется для преобразования данных между параллельным и последовательным форматами. В основном, SerDes преобразует данные из формата, который может передаваться одновременно по нескольким проводникам (параллельный), в формат, который передается последовательно по одному проводнику (серийный), и наоборот.</p><p>Примеры использования SerDes включают в себя передачу данных между компонентами компьютера, такими как микропроцессоры и память, а также в средствах связи, например, для преобразования данных между оптическими и электрическими сигналами в сетях передачи данных.</p><p>В общем, SerDes помогает эффективно и надежно передавать данные между устройствами и компонентами, используя разные методы кодирования и модуляции для оптимизации скорости и качества передачи данных.</p></div></div><p>При диагностике мы установили, что SerDes1 в режиме XFI не видит опорную частоту и не может, соответственно, запустить ни одно устройство через себя. В результате выяснили, что нужные &quot;ножки&quot; процессора вообще не задействованы и частоты там быть и не может.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Из карты &quot;больного&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Исходя из ДШ на чип</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Serdes 1 в режиме XFI должен брать источником PLL2 замуксованный через rcw на RefCLK2,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">refclk2 не подключен</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="Alt text" src="/assets/images/pins-1-c8a554d846a2f661252b889a24d8f2ef.jpg" width="1177" height="464" class="img_ev3q"></p><p>Заказчик, надо отдать ему должное, был готов этот этап принять с 1Гбит сетью, но нам как то было &quot;западло&quot; такое сдавать и мы продолжили мучиться.</p><p>В целом поступило смелое предложение сверлить текстолит и &quot;пробиваться&quot; к шарику процессора, чтобы подцепить волосок в нужную площадку. Эта процедура хирургическая, но возможная. </p><p>Однако мы стали думать, где уже есть частота. </p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Из выписки &quot;больного&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PLL2 согласно DS может брать колок от первого или второго входа SD1_REF_CLK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Надо было грубо править RCW</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Справка от ChatGPT</div><div class="admonitionContent_S0QG"><p>RCW - это сокращение от &quot;Reset Configuration Word&quot; или &quot;Слово Конфигурации Сброса&quot;. В контексте запуска микропроцессоров и систем на базе процессоров от NXP Semiconductors (ранее Freescale Semiconductor), RCW представляет собой специальный блок данных или параметров, который используется для настройки поведения процессора и системы при запуске или после сброса.</p><p>Когда микропроцессор начинает работу или перезагружается, он считывает RCW, который хранится в некоторой перманентной памяти, и использует эту информацию для настройки различных аспектов своей работы. Например, RCW может содержать информацию о том, какие интерфейсы и устройства должны быть активированы, какие параметры тактовой частоты следует установить, и другие конфигурационные данные.</p><p>RCW обычно настраивается в процессе проектирования и настройки системы, и он может быть уникален для каждой конкретной системы на базе микропроцессора от NXP. Это позволяет разработчикам настраивать параметры системы под свои нужды, оптимизируя ее работу для конкретных приложений.</p><p>Важно правильно настроить RCW, так как это влияет на инициализацию и работу микропроцессора и системы в целом. Обычно, в документации к конкретному микропроцессору или системной плате от NXP, вы найдете подробные инструкции по настройке RCW для вашей системы.</p></div></div><p>Для того, чтобы &quot;хакнуть&quot; даташит пришлось написать небольшой <a href="/1046hextobin">дешифратор RCW</a>, чтобы из лога загрузки считывать какие значения принимают параметры.</p><p>Понятно, что &quot;через костыль&quot; но 10Гбит увиделись и заработали с поправленным RCW.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="шаг4-температура">ШАГ4. Температура<a href="#шаг4-температура" class="hash-link" aria-label="Прямая ссылка на ШАГ4. Температура" title="Прямая ссылка на ШАГ4. Температура">​</a></h3><p>После этого осталась не сильно зависящая от нас часть - это провести стресс тесты и замерить температуры в пассивном корпусе. </p><p><img loading="lazy" alt="Alt text" src="/assets/images/with-case-1-f054c86f28b92e762dd142785d3eb65e.jpg" width="468" height="508" class="img_ev3q"></p><p>Для процессора опять же был написан <a href="/cpuChart">скрипт</a> и сервис, строящий графики на основе получаемого json-a.</p><p><img loading="lazy" alt="Alt text" src="/assets/images/chart1-65d51aad294e83cc513f52751573f052.png" width="793" height="572" class="img_ev3q"></p><p>Интересно, что греется не столько процессор (он умеет снижать частоту при высокой температуре), сколько активные антенны 60Ггц, но хороший радиатор позволяет и их &quot;держать&quot; в диапазоне до 60 градусов.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="выводы-вместо-постскриптума">Выводы (вместо постскриптума)<a href="#выводы-вместо-постскриптума" class="hash-link" aria-label="Прямая ссылка на Выводы (вместо постскриптума)" title="Прямая ссылка на Выводы (вместо постскриптума)">​</a></h3><p>Из любого &quot;подвига&quot; нужно делать выводы, чтобы его не повторять. </p><p>При проектировании сложных плат нужно придерживаться следующих принципов</p><ol><li><strong>Делать дизайн как можно ближе к работающей &quot;девборде&quot;.</strong> Чем ближе ваш девайс к девборде, тем меньше изменений в софте. Да, как показала практика, можно делать &quot;лютый&quot; кастом, но время и риски возрастают. Разработчики процессоров и обвязки имеют все-равно больше опыта, а документация всегда не бесспорна. Погружаться в страшную документацию на тысячи страниц долго, тяжело и рискованно.</li><li><strong>Не смотря на предыдущий опыт, при дизайне платы максимально уделить времени импедансам, переходам, углам, длинам линий.</strong> Это банально, но надо трассировать и проверять всеми существующими  инструментами. Нельзя оставлять выбивающиеся &quot;желтые&quot; или &quot;красные&quot; места, потому что до этого так где-то работало или потому что и так должно работать. В этом слоеном пироге и так все будет глючить, не надо добавлять сомнительных сущностей.</li><li><strong>*Если на девборде есть &quot;странные&quot; или &quot;ненужные&quot; части (фильтры, подтяжки, делители, ретаймеры) - не игнорировать их.</strong> Разбираться зачем они и если непонятно, все-равно ставить. </li><li><strong>Выводить на плату площадки для измерений и &quot;подпайки&quot;.</strong> Надо думать о том, где вы сможете промерить опорные напряжения и частоты, куда подпаяться при необходимости контрольный разъем.</li><li><strong>У процессоров своя сложная система старта, необходимо уделить этому внимание.</strong> Как показал наш пример, старт процессора - отдельная программа на MCU, ошибки в которой вообще не позволяют старт системы.</li><li><strong>Уделяйте особое внимание питанию и обратной связи по питанию.</strong> Ошибки по питанию ведут к плавающим непредсказуемым глюкам при нагрузках, которые тяжело поймать и объяснить.</li><li><strong>Всегда при менеджменте проекта предполагать, что в плате могут быть такие ошибки, что понадобиться ее перезаказывать с исправлениями. Не все можно сделать на лету.</strong>. Цикл заказа с исправлениями - 2 месяца, это надо заложить в контракт. </li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="спасибо-котам-покровителям">Спасибо котам-покровителям<a href="#спасибо-котам-покровителям" class="hash-link" aria-label="Прямая ссылка на Спасибо котам-покровителям" title="Прямая ссылка на Спасибо котам-покровителям">​</a></h3><p>Наши коты-покровители, к которым мы виртуально прикладываем платы, в моменты отчаяния и нервного напряжения (а они были).</p><p><img loading="lazy" alt="Alt text" src="/assets/images/cats-6e5d3d1aa39974b580a33c123ca1cbcc.png" width="697" height="256" class="img_ev3q"></p></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_mRVl"><div class="col"><b>Теги:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/team">team</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/lab-240">lab240</a></li></ul></div><div class="col margin-top--sm"><a href="https://github.com/lab240/lab240.github.io/blob/main/blog/2023-08-26-1046-up-2/index.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Отредактировать эту страницу</a></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Навигация по странице поста блога"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/ls1046a-cpu-chart"><div class="pagination-nav__sublabel">Следующий пост</div><div class="pagination-nav__label">Статистика по процессору LS1046a</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/telegraf-starlark"><div class="pagination-nav__sublabel">Предыдущий пост</div><div class="pagination-nav__label">Работа с данными в Telegraf</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#шаг1-процедура-запуска-процессора" class="table-of-contents__link toc-highlight">ШАГ1. Процедура запуска процессора.</a></li><li><a href="#шаг2-питание-питание-и-еще-раз-питание" class="table-of-contents__link toc-highlight">ШАГ2. Питание питание и еще раз питание</a></li><li><a href="#шаг3-несущие-частоты-тяжелый-случай" class="table-of-contents__link toc-highlight">ШАГ3. Несущие частоты. Тяжелый случай.</a></li><li><a href="#шаг4-температура" class="table-of-contents__link toc-highlight">ШАГ4. Температура</a></li><li><a href="#выводы-вместо-постскриптума" class="table-of-contents__link toc-highlight">Выводы (вместо постскриптума)</a></li><li><a href="#спасибо-котам-покровителям" class="table-of-contents__link toc-highlight">Спасибо котам-покровителям</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Lab240 Сделано на Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.e46d4798.js"></script>
<script src="/assets/js/main.23a0e9f7.js"></script>
</body>
</html>